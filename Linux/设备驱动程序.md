# 设备驱动程序

## 访问设备

设备特殊文件（设备文件）用于访问拓展设备。这些文件并不关联到硬盘或者任何其他存储介质上的数据段，而是**建立了与某个设备驱动程序的连接，以支持与扩展设备的通讯**。就应用程序而言，普通文件和设备文件的差别是有一些的。二者都可以通过同样的库函数处理，但是为了处理方便，系统还提供了几个额外的命令用于设备文件。

### 1. 设备文件

设备并不是通过其文件名标识，而是**通过文件的主、从设备号标识**。这些号码在文件系统中作为特别的文件属性管理。即：管理文件是通过主从设备号，而不是文件名。

### 2. 字符设备、块设备和其他设备

根据外设和系统之间交换数据的方法，可以将设备分为几种类别。有些设备非常适合于面向字符的数据交换，因为数据传输量很低。其他的设备则更适合于处理包含固定数目字节的数据块。内核会区**分字符设备**和**块设备**。

- 字符设备：串行接口，文本终端等
- 块设备：硬盘，光驱等

#### 1. 标识设备文件

>brw-r-----1 root disk 8, 0 2009-02-01 21:06 /dev/sda
>
>crw-r-----1 root disk 8, 16 2008-02-01 21:52 ttyS0

上面的输出都与普通文件没有什么区别。其中有两个重要的区别：

- 访问权限之前的字母b或者c，分别表示**块设备**和**字符设备**。
- 设备文件没有长度，而是增加了另外两个值，分别是**主设备号**和**从设备号**。二者共同形成了一个唯一的号码，内核可由此来查找对应的设备驱动程序。

内核采用主从设备号来标识匹配的驱动程序。采用两个号码的原因，与设备的驱动程序的通用结构有关。首先，系统可能包含几个同样类型的设备，有同一个设备驱动管理程序，其次，可以将同类设备合并起来，便于插入到内核的数据结构中进行管理。<u>主设备号用于寻址设备驱动程序自身</u>。