# 理解音频焦点

![Audio focus](https://cdn-images-1.medium.com/max/2000/1*2_mUAwAihjBYMszQCCL0Mw.png)

# 第一部分

在你的Android设备上有许多的App可以同时播放音频。当Android操作系统将所有的音频流混合在一起的时候，对于一个用户来说这可能就是有破坏性的。这样的结果就会导致一个很差的用户体验。为了有一个良好的用户体验，Android系统提供给了一个API来让所有的Apps之间分享音频焦点（audio focus），在同一时刻，只有一个App可以持有音频焦点。

这个系列文章的目的在于：
*  让你更好、更深入的理解什么是**音频焦点**。
*  为什么一个好的多媒体体验是非常重要的。
*  如何使用它

此系列文章将包括：

  1. 运作一个良好的多媒体的App的重要性以及最常见的音频焦点使用场景（第一部分）
  2. 音频焦点对于多媒体应用程序用户体验重要性的其他用例（第二部分）
  3. 在你的应用中实现音频焦点的三个步骤（第三部分）

音频焦点是协作性质的，而且它依赖于各个App遵守音频焦点的使用准则。系统不会强迫去遵守这些准则，如果一个应用想在失去音频焦点之后还可以继续的大声播放，这件事情是无法被阻止的。然而，这回导致一个非常糟糕的用户体验，对于用户想卸载你的应用来说这可是一个好机会。这有一些使用音焦点景去播放的场景。假设用户启动了你的App，这个App正在播放一段音频。当你的App需要输出音频的时候，它应该请求音频焦点。只有在被授权了音频焦点之后，才应该去播放音频。

## 场景1 - 当你的App正在播放音频，当前用户启动了另一个多媒体App来播放音频

### 如果你的App不处理音频焦点，会发生什么呢？

如果另一个App开始播放音频，它会覆盖你正在播放的音频。结果就是体验很差，谁的也听不清楚了。

![Playing simultaneously](https://cdn-images-1.medium.com/max/800/1*zaIB6fKmwSwhm_UM3Yox_A.png)

### 处理音频焦点的App会发生什么情况？

当其他的多媒体应用开始播放音频，它应该请求**永久的音频焦点**。一旦系统给了音频焦点，**它将开始播放。你的应用需要通过停止播放来响应永久音频焦点的丢失**，所以用户只会听到另一个App播放的音频。

![Playing simultaneously](https://cdn-images-1.medium.com/max/800/1*xk8Tio4_XxtmuoH9CK7qkQ.png)

现在，如果用户想在你的App中继续播放音频，之后你的App将会请求音频焦点。只有当你的音频焦点被授权之后，你的App才可以继续播放音频。其它的App也会通过停止播放音频来响应音频焦点的丢失。

## 场景2 - 你听音乐正嗨，突然来了电话

### 如果你的App不处理音频焦点会发生什么

当你的手机开始响铃时，除了铃声之外用户也会听到你的App中播放的音频，这当然不是一个好的用户体验。如果他们选择了拒绝接听，那么你的音频应该继续播放。如果他们选择了接通电话，你App中的音频会随着手机通化音频一起播放。当它们完成了通话，如果你的App不会自动恢复播放的话，这当然也不是一个好的用户体验。

![Playing simultaneously](https://cdn-images-1.medium.com/max/1000/1*_HjTvrT4locQYp8LHIMVrA.png)

### 如果你的App处理了音频焦点会发生什么情况呢？

当你的手机铃声响起（而且用户还没有接通），你的App应该响应一个暂时的音频焦点丢失，响应的方式可以是降低音量，可以通过降低当前音量的20%来完成响应，或者一齐暂停当前所有音频。

 - 如果这个用户拒绝了这通电话，那么你的App应该通过恢复音量来响应焦点的重新获得，或者恢复播放。


 - 如果这个用户接通了电话，那么系统会通知你丢失了音频焦点。那么你的音频应该暂停播放。当它们电话打完了，你的App应该通过以正常音量恢复播放来响应音频焦点的重新获得。

![Playing simultaneously](https://cdn-images-1.medium.com/max/1000/1*P1JDTh8I8XkDwXMPjGD2cg.png)

当你的App需要输出音频，它就要请求音频焦点。只有在被授予了音频焦点之后，它才应该播放音频。然而，你得到的音频焦点不会乖乖地等你把音频播完，其它的App也会请求这个音频焦点，并且会抢占了这个音频焦点。在这种情况下，你的App应该暂停播放或者降低音量来让用户更容易听到新的音频资源。

# 第二部分（更多场景）

## 场景3 - 在后台运行的导航类App提供了导航音频，而另一个App正在播放音频

### 如果不处理音频焦点会怎么样？

重叠的导航音频和音乐会使得用户分神。

### 应该如何处理音频焦点呢？

当导航App播报下一个指令的时候，你的App应该减小音量来响应焦点暂时的丢失（因为导航App正在播放音频）。但在一些情况中，你的App应该停止播放：播放音频书，播客，讲述。

当导航App的指令播放完毕之后，它会扔掉音频焦点（audio focus），而你的App会重新拿到这个焦点，而你的App应该恢复音量到原来的等级上去，作为重新获得音频焦点的响应。

## 场景4 - 当接通电话时，用户启动了一个会播放音频的Game

### 如果不处理音频会怎么样？
用户体验很差，因为音频和电话通话的声音叠加到了一起。

###  应该如何处理音频焦点呢？
在Android O的版本，这有一个关于音频焦点的特性，叫做“**取得被延迟的音频焦点**”。这个特性恰巧就是为这个场景创建的。看这个例子，当用户正在打电话，而且他有启动了一个游戏来玩，他们想打游戏但是又不想听到任何游戏的声音，但是电话结束后，游戏的音频又要回来让他们听到。

如果你的App想支持这个功能，并且用户正在打电话（已经获得了暂时的音频焦点）时播放音频，则会发生两件事情。

1. 当你的App请求永久的音频焦点时， 系统拒绝了授予，因为它被锁住了。系统的电话App已经取得了暂时的音频焦点。你的Game App不应该播放音频（它可能会在稍后的某个时间被授予音频焦点）。然而，在这种情况下，你的App是个游戏，可能会在没有音频的条件下持续工作。

2. 当电话结束了，你的App会被授予“获得音频焦点” `audio focus gain`。它的授权被延迟了一段时间（最初的请求是在用户打电话的时候）。你可以像处理当一个暂时性的音频焦点丢失后又重新获得焦点那样来处理这种场景。在这种情况下，它会开始播放音频。

而在Android O之前的版本并不支持这样的特性（`delayed audio focus gain`），在以前的版本中，当你的App试图开始播放音频而用户正在打电话，这个音频焦点的请求可能不会被简单的授权，而且即使通话结束，播放也不会开始。
